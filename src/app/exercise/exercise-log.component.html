<div class="page">
  <h2>Exercise Log</h2>

  <div class="alert error" *ngIf="errorMsg">{{ errorMsg }}</div>
  <div class="alert success" *ngIf="successMsg">{{ successMsg }}</div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="card">
    <div class="grid">
      <label>
        <div class="label">Date & Time</div>
        <input type="datetime-local" formControlName="dateTime">
      </label>

      <label>
        <div class="label">Activity</div>
        <select formControlName="activityType">
          <option *ngFor="let a of activities" [value]="a">{{ a }}</option>
        </select>
      </label>

      <label>
        <div class="label">Duration (minutes)</div>
        <input type="number" formControlName="durationMinutes" min="1" step="1">
      </label>

      <label>
        <div class="label">Distance (miles) — optional</div>
        <input type="number" formControlName="distance" min="0" step="0.01">
      </label>

      <label class="full">
        <div class="label">Notes</div>
        <textarea formControlName="notes" rows="2"></textarea>
      </label>
    </div>

    <div class="actions">
      <button type="submit" [disabled]="form.invalid">{{ isEditing ? 'Update' : 'Save' }}</button>
      <button type="button" class="secondary" *ngIf="isEditing" (click)="cancelEdit()">Cancel</button>
    </div>
  </form>

  <div *ngIf="loading">Loading…</div>

  <table *ngIf="!loading && items.length" class="table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Activity</th>
        <th>Duration</th>
        <th>Distance (mi)</th>
        <th>Notes</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let it of items">
        <td>{{ it.date | date:'short' }}</td>
        <td>{{ it.activityType }}</td>
        <td>{{ it.durationMinutes }}</td>
        <td>{{ it.distanceMiles || 0 }}</td>
        <td>{{ it.notes }}</td>
        <td class="right">
          <button type="button" (click)="edit(it)">Edit</button>
          <button type="button" class="danger" (click)="delete(it._id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="!loading && !items.length" class="muted">No sessions yet.</p>
</div>
